<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <style>
      a {
        text-decoration: none;
        color: rgba(190, 0, 0, 0.507);
      }
    </style>
  </head>
  <body>
    <div class="data">
      <div id="chart"></div>
    </div>
    <script>
      let stock = [
        {
          TradingDate: "02/04/2024",
          Time: "14:39:10",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10000,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9900,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 1634500,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },
        {
          TradingDate: "02/04/2024",
          Time: "14:40:09",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10000,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9900,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 1634500,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },
        {
          TradingDate: "02/04/2024",
          Time: "14:40:29",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10050,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9950,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 1634500,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },
        {
          TradingDate: "02/04/2024",
          Time: "14:41:05",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10050,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9950,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 326900,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },

        {
          TradingDate: "02/04/2024",
          Time: "14:42:05",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10050,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9950,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 326900,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },

        {
          TradingDate: "02/04/2024",
          Time: "14:42:35",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10050,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9950,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 326900,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },

        {
          TradingDate: "02/04/2024",
          Time: "14:43:00",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10050,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9950,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 326900,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },

        {
          TradingDate: "02/04/2024",
          Time: "14:43:25",
          Exchange: "UPCOM",
          Symbol: "OIL",
          RType: "X-QUOTE",
          AskPrice1: 10050,
          AskPrice2: 10100,
          AskPrice3: 10200,
          AskPrice4: 10300,
          AskPrice5: 10400,
          AskPrice6: 10500,
          AskPrice7: 10600,
          AskPrice8: 10700,
          AskPrice9: 10800,
          AskPrice10: 10900,
          AskVol1: 384600,
          AskVol2: 348500,
          AskVol3: 385100,
          AskVol4: 157100,
          AskVol5: 105500,
          AskVol6: 22000,
          AskVol7: 8500,
          AskVol8: 3800,
          AskVol9: 12200,
          AskVol10: 2700,
          BidPrice1: 9950,
          BidPrice2: 9800,
          BidPrice3: 9700,
          BidPrice4: 9600,
          BidPrice5: 9500,
          BidPrice6: 9400,
          BidPrice7: 9300,
          BidPrice8: 9200,
          BidPrice9: 9100,
          BidPrice10: 9000,
          BidVol1: 326900,
          BidVol2: 276500,
          BidVol3: 153200,
          BidVol4: 34900,
          BidVol5: 6000,
          BidVol6: 3000,
          BidVol7: 6500,
          BidVol8: 3500,
          BidVol9: 3700,
          BidVol10: 3000,
          TradingSession: "LO",
        },
      ];
      function drawChart() {
        // Clear the old chart
        d3.select("#chart").selectAll("*").remove();
        const time = stock.map((data) => new Date("1970-01-01T" + data.Time));

        const ask = [];
        const bid = [];
        for (let i = 0; i < stock.length; i++) {
          for (let j = 1; j <= 10; j++) {
            if (stock[i]["AskPrice" + j] && !ask[stock[i]["AskPrice" + j]]) {
              ask[stock[i]["AskPrice" + j]] = [];
            }
            if (stock[i]["BidPrice" + j] && !bid[stock[i]["BidPrice" + j]]) {
              bid[stock[i]["BidPrice" + j]] = [];
            }
            if (stock[i]["AskPrice" + j])
              ask[stock[i]["AskPrice" + j]][i] = stock[i]["AskVol" + j];
            if (stock[i]["BidPrice" + j])
              bid[stock[i]["BidPrice" + j]][i] = stock[i]["BidVol" + j];
          }
        }

        const allValues = Object.values(ask)
          .flat()
          .concat(Object.values(bid).flat());
        const yMax = Math.max(...allValues);
        const yMin = Math.min(...allValues);

        const allKeys = Object.keys(ask)
          .concat(Object.keys(bid))
          .map(Number)
          .sort((a, b) => a - b);

        const yLower =
          Math.min(...allKeys) -
          0.12 * (Math.max(...allKeys) - Math.min(...allKeys));
        const yUpper =
          Math.max(...allKeys) +
          0.12 * (Math.max(...allKeys) - Math.min(...allKeys));
        const xLower =
          Math.min(...time) - 0.08 * (Math.max(...time) - Math.min(...time));
        const xUpper =
          Math.max(...time) + 0.08 * (Math.max(...time) - Math.min(...time));

        const margin = { top: 20, right: 20, bottom: 30, left: 80 };
        const marginTop = 20;
        const marginRight = 20;
        const marginBottom = 30;
        const marginLeft = 80;
        const viewportWidth = window.innerWidth;
        const viewportHeight = window.innerHeight;
        const width = viewportWidth - margin.left - margin.right;
        const height = viewportHeight - margin.top - margin.bottom;
        const timeFormat = d3.timeFormat("%H:%M:%S");
        const circleRadius = 100;

        const x = d3
          .scaleTime()
          .domain([xLower, xUpper])
          .range([marginLeft, width - marginRight]);

        const y = d3
          .scaleLinear()
          .domain([yLower, yUpper])
          .range([height - marginBottom, marginTop]);
        const xAxis = d3.axisBottom(x).tickFormat(timeFormat).tickValues(time);
        const yAxis = d3.axisLeft(y).tickValues(allKeys);

        const svg = d3
          .create("svg")
          .attr("width", width)
          .attr("height", height);

        svg
          .append("g")
          .attr("transform", `translate(${marginLeft},0)`)
          .call(yAxis)
          .selectAll("text")
          .attr("color", "#131722")
          .attr("font-size", "16px");
        svg
          .append("g")
          .attr("transform", `translate(0,${height - marginBottom})`)
          .call(xAxis)
          .selectAll("text")
          .attr("color", "#131722")
          .attr("font-size", "16px");
        document.querySelector("#chart").appendChild(svg.node());

        for (let key in ask) {
          for (let i = 0; i < ask[key].length; i++) {
            let value = ask[key][i];
            if (value) {
              svg
                .append("circle")
                .attr("cx", x(time[i]))
                .attr("cy", y(key))
                .attr(
                  "r",
                  (value / yMax) * circleRadius > 5
                    ? (value / yMax) * circleRadius
                    : 5
                )
                .attr("fill", "#fdeded75")
                .attr("stroke", "#ef5350")
                .attr("stroke-width", 1);
            }
          }
        }

        for (let key in bid) {
          for (let i = 0; i < bid[key].length; i++) {
            let value = bid[key][i];
            if (value) {
              svg
                .append("circle")
                .attr("cx", x(time[i]))
                .attr("cy", y(key))
                .attr(
                  "r",
                  (value / yMax) * circleRadius > 5
                    ? (value / yMax) * circleRadius
                    : 5
                )
                .attr("fill", "#e9f6f575")
                .attr("stroke", "#26a69a")
                .attr("stroke-width", 1);
            }
          }
        }

        for (let i = 0; i < stock.length - 1; i++) {
          svg
            .append("line")
            .attr("x1", x(time[i]))
            .attr("y1", y(stock[i]["AskPrice1"]))
            .attr("x2", x(time[i + 1]))
            .attr("y2", y(stock[i + 1]["AskPrice1"]))
            .attr("stroke", "#ef5350")
            .attr("stroke-width", 1);
          svg
            .append("line")
            .attr("x1", x(time[i]))
            .attr("y1", y(stock[i]["BidPrice1"]))
            .attr("x2", x(time[i + 1]))
            .attr("y2", y(stock[i + 1]["BidPrice1"]))
            .attr("stroke", "#26a69a")
            .attr("stroke-width", 1);
        }
      }
      drawChart();
    </script>
  </body>
</html>
